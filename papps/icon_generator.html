<!DOCTYPE html>
<html lang="ja">
<head>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2216%22 height=%2216%22 viewBox=%220 0 16 16%22><text x=%220%22 y=%2214%22 font-size=%2216%22>&#x1f414;</text></svg>" type="image/svg+xml">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MSTVN0KCF9"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-MSTVN0KCF9');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アイコン画像生成ツール</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 67vw;
            min-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #e8f6f3 0%, #a7d8d0 30%, #7fb3d3 70%, #5dade2 100%);
            min-height: 100vh;
            color: #2c3e50;
        }
        
        @media (max-width: 1200px) {
            body {
                max-width: 90vw;
                min-width: auto;
            }
        }
        
        @media (max-width: 768px) {
            body {
                max-width: 95vw;
                padding: 15px;
            }
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(45, 156, 140, 0.15), 0 8px 30px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        h1 {
            text-align: center;
            color: #2d9c8c;
            margin-bottom: 40px;
            font-size: 2.8em;
            font-weight: 700;
            background: linear-gradient(45deg, #2d9c8c, #16a085, #27ae60);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 15px rgba(45, 156, 140, 0.3);
            letter-spacing: -0.5px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }
        
        input, select {
            padding: 14px;
            border: 2px solid rgba(45, 156, 140, 0.2);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.9);
            color: #2c3e50;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #16a085;
            box-shadow: 0 0 0 4px rgba(22, 160, 133, 0.1);
            background: white;
        }
        
        .emoji-input {
            font-size: 32px;
            text-align: center;
            height: 80px;
        }
        
        .color-group {
            display: flex;
            gap: 10px;
            align-items: end;
        }
        
        .color-group input[type="color"] {
            width: 60px;
            height: 50px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .generate-btn {
            background: linear-gradient(45deg, #16a085, #27ae60);
            color: white;
            padding: 16px 28px;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
            white-space: nowrap;
            box-shadow: 0 6px 20px rgba(22, 160, 133, 0.3);
            letter-spacing: 0.5px;
        }
        
        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(22, 160, 133, 0.4);
            background: linear-gradient(45deg, #1abc9c, #2ecc71);
        }
        
        .preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
            max-width: 100%;
            overflow-x: auto;
        }
        
        .preview-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.85);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(45, 156, 140, 0.1), 0 4px 15px rgba(0,0,0,0.05);
            transition: all 0.3s;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
        }
        
        .preview-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(45, 156, 140, 0.15), 0 8px 25px rgba(0,0,0,0.08);
        }
        
        .preview-item h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 18px;
        }
        
        .preview-item canvas {
            border: 2px solid #ddd;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            image-rendering: crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
        }
        
        /* 64px以下は実際のサイズで表示 */
        .preview-item canvas[width="16"], 
        .preview-item canvas[width="32"],
        .preview-item canvas[width="48"],
        .preview-item canvas[width="64"] {
            width: auto;
            height: auto;
            cursor: pointer;
        }
        
        /* 128px以上は縮小表示 */
        .preview-item canvas[width="128"],
        .preview-item canvas[width="256"],
        .preview-item canvas[width="512"],
        .preview-item canvas[width="1024"] {
            max-width: 120px;
            max-height: 120px;
            width: auto;
            height: auto;
            cursor: pointer;
        }
        
        .download-btn {
            background: linear-gradient(45deg, #e67e22, #f39c12);
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(230, 126, 34, 0.3);
            letter-spacing: 0.3px;
        }
        
        .download-btn:hover {
            background: linear-gradient(45deg, #d35400, #e67e22);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(230, 126, 34, 0.4);
        }
        
        .instructions {
            background: rgba(232, 246, 243, 0.8);
            border-radius: 20px;
            margin-top: 40px;
            border-left: 5px solid #16a085;
            box-shadow: 0 8px 25px rgba(22, 160, 133, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
        }
        
        .instructions-header {
            padding: 25px 30px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            user-select: none;
        }
        
        .instructions-header:hover {
            background: rgba(22, 160, 133, 0.05);
        }
        
        .instructions-header h3 {
            margin: 0;
            color: #16a085;
            font-size: 22px;
            font-weight: 700;
        }
        
        .instructions-toggle {
            font-size: 20px;
            color: #16a085;
            transition: transform 0.3s;
        }
        
        .instructions-toggle.open {
            transform: rotate(180deg);
        }
        
        .instructions-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, padding 0.4s ease-out;
            padding: 0 30px;
        }
        
        .instructions-content.open {
            max-height: 800px;
            padding: 0 30px 30px 30px;
        }
        
        .instructions ol {
            margin: 15px 0;
            padding-left: 25px;
        }
        
        .instructions li {
            margin: 8px 0;
            line-height: 1.6;
        }
        
        .emoji-suggestions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
            gap: 8px;
            margin-top: 15px;
        }
        
        .emoji-btn {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(240, 240, 240, 0.8));
            border: 2px solid rgba(45, 156, 140, 0.2);
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 50px;
            min-width: 50px;
        }
        
        .emoji-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
            background: linear-gradient(145deg, rgba(232, 246, 243, 0.9), rgba(220, 240, 235, 0.8));
            border-color: #16a085;
        }
        
        .source-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 15px;
        }
        
        .toggle-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e8f6f3;
            padding: 16px 32px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            color: #2c3e50;
        }
        
        .toggle-btn.active {
            background: linear-gradient(45deg, #16a085, #27ae60);
            color: white;
            border-color: #16a085;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(22, 160, 133, 0.3);
        }
        
        .toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            border-color: #16a085;
        }
        
        .upload-area {
            border: 3px dashed rgba(45, 156, 140, 0.3);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            background: rgba(232, 246, 243, 0.5);
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .upload-area:hover {
            border-color: #16a085;
            background: rgba(232, 246, 243, 0.8);
            transform: translateY(-2px);
        }
        
        .upload-area.drag-over {
            border-color: #16a085;
            background: rgba(22, 160, 133, 0.1);
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(22, 160, 133, 0.2);
        }
        
        .upload-area input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 10;
        }
        
        .upload-text p {
            margin: 8px 0;
            color: #666;
            font-size: 16px;
        }
        
        .upload-text p:first-child {
            font-weight: 600;
            color: #333;
            font-size: 18px;
        }
        
        .upload-area .image-preview {
            margin: 0;
            text-align: center;
            width: 100%;
        }
        
        .upload-area .image-preview img {
            max-width: 150px;
            max-height: 150px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            margin-bottom: 15px;
        }
        
        .upload-area .image-preview .remove-btn {
            background: linear-gradient(45deg, #ff4757, #ff3742);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(255, 71, 87, 0.3);
            position: relative;
            z-index: 20;
        }
        
        .upload-area .image-preview .remove-btn:hover {
            background: linear-gradient(45deg, #ff3742, #ff2730);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4);
        }
        
        .size-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .size-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .size-checkbox:hover {
            background: #e9ecef;
            border-color: #667eea;
        }
        
        .size-checkbox input[type="checkbox"] {
            margin: 0;
            transform: scale(1.2);
        }
        
        .feature-box {
            background: rgba(255, 248, 225, 0.9);
            padding: 25px;
            border-radius: 18px;
            margin-top: 25px;
            border: 2px solid rgba(241, 196, 15, 0.3);
            box-shadow: 0 6px 20px rgba(241, 196, 15, 0.15);
            backdrop-filter: blur(10px);
        }
        
        .feature-box h4 {
            margin-top: 0;
            color: #d68910;
            font-size: 18px;
            font-weight: 700;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .feature-list li {
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 15px;
            border-radius: 10px;
            list-style: none;
            font-size: 14px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .gradient-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        
        .gradient-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .gradient-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            border-color: #667eea;
        }
        
        .gradient-btn:hover::after {
            content: attr(title);
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            pointer-events: none;
        }
        
        .gradient-btn:hover::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid rgba(0,0,0,0.8);
            z-index: 100;
            pointer-events: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.3s ease-out;
            max-height: 90vh;
            overflow: auto;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #333;
            font-size: 24px;
        }
        
        .close {
            background: linear-gradient(45deg, #ff4757, #ff3742);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .close:hover {
            background: linear-gradient(45deg, #ff3742, #ff2730);
            transform: scale(1.05);
        }
        
        .modal-body {
            text-align: center;
            padding: 20px 0;
        }
        
        .full-size-canvas {
            border: 3px solid #ddd;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            max-width: 100%;
            height: auto;
            image-rendering: crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
        }
        
        .size-info {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .gradient-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .modal-content {
                margin: 10% auto;
                padding: 20px;
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎨 アイコン画像生成ツール</h1>
        
        <div class="source-toggle">
            <button class="toggle-btn active" onclick="toggleSource('emoji')" id="emojiToggle">✨ 絵文字を使用</button>
            <button class="toggle-btn" onclick="toggleSource('image')" id="imageToggle">🖼️ 画像をアップロード</button>
        </div>
        
        <div class="controls">
            <div class="control-group" id="emojiControls">
                <label for="emoji">絵文字を選択:</label>
                <input type="text" id="emoji" class="emoji-input" value="🎨" maxlength="2">
                <div class="emoji-suggestions">
                    <button class="emoji-btn" onclick="setEmoji('🎨')">🎨</button>
                    <button class="emoji-btn" onclick="setEmoji('🚀')">🚀</button>
                    <button class="emoji-btn" onclick="setEmoji('💡')">💡</button>
                    <button class="emoji-btn" onclick="setEmoji('⭐')">⭐</button>
                    <button class="emoji-btn" onclick="setEmoji('🔥')">🔥</button>
                    <button class="emoji-btn" onclick="setEmoji('💎')">💎</button>
                    <button class="emoji-btn" onclick="setEmoji('🌟')">🌟</button>
                    <button class="emoji-btn" onclick="setEmoji('🎯')">🎯</button>
                    <button class="emoji-btn" onclick="setEmoji('🛸')">🛸</button>
                    <button class="emoji-btn" onclick="setEmoji('⚡')">⚡</button>
                    <button class="emoji-btn" onclick="setEmoji('🎪')">🎪</button>
                    <button class="emoji-btn" onclick="setEmoji('🌈')">🌈</button>
                </div>
            </div>
            
            <div class="control-group" id="imageControls" style="display: none;">
                <label for="imageUpload">画像をアップロード:</label>
                <div class="upload-area" id="uploadArea">
                    <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)">
                    <div class="upload-text" id="uploadText">
                        <p>📁 クリックして画像を選択</p>
                        <p>または画像をドラッグ&ドロップ</p>
                        <p><strong>📋 Ctrl+V でクリップボードから貼り付け</strong></p>
                        <p style="font-size: 14px; color: #888;">対応形式: PNG, JPG, GIF, WebP など</p>
                    </div>
                    <div class="image-preview" id="imagePreview" style="display: none;"></div>
                </div>
            </div>
            
            <div class="control-group">
                <label for="bgStyle">背景スタイル:</label>
                <select id="bgStyle" onchange="updateColorInputs()">
                    <option value="solid">単色</option>
                    <option value="gradient">グラデーション</option>
                    <option value="transparent">透明</option>
                </select>
                
                <div id="colorControls" style="margin-top: 15px;">
                    <label>背景色:</label>
                    <div class="color-group">
                        <div>
                            <input type="color" id="bgColor1" value="#4a90e2">
                            <label for="bgColor1" style="font-size: 12px; margin: 5px 0 0 0;">メイン</label>
                        </div>
                        <div id="color2Group" style="display: none;">
                            <input type="color" id="bgColor2" value="#764ba2">
                            <label for="bgColor2" style="font-size: 12px; margin: 5px 0 0 0;">サブ</label>
                        </div>
                    </div>
                    <div class="gradient-suggestions" id="gradientSuggestions" style="display: none;">
                        <label style="font-size: 12px; margin-bottom: 8px;">おすすめグラデーション:</label>
                        <div class="gradient-grid">
                            <button class="gradient-btn" onclick="setGradient('#4a90e2', '#764ba2')" style="background: linear-gradient(45deg, #4a90e2, #764ba2);" title="ブルー"></button>
                            <button class="gradient-btn" onclick="setGradient('#ff6b6b', '#ffa726')" style="background: linear-gradient(45deg, #ff6b6b, #ffa726);" title="サンセット"></button>
                            <button class="gradient-btn" onclick="setGradient('#4caf50', '#81c784')" style="background: linear-gradient(45deg, #4caf50, #81c784);" title="グリーン"></button>
                            <button class="gradient-btn" onclick="setGradient('#9c27b0', '#e1bee7')" style="background: linear-gradient(45deg, #9c27b0, #e1bee7);" title="パープル"></button>
                            <button class="gradient-btn" onclick="setGradient('#2196f3', '#00bcd4')" style="background: linear-gradient(45deg, #2196f3, #00bcd4);" title="オーシャン"></button>
                            <button class="gradient-btn" onclick="setGradient('#ff5722', '#ff9800')" style="background: linear-gradient(45deg, #ff5722, #ff9800);" title="オレンジ"></button>
                            <button class="gradient-btn" onclick="setGradient('#e91e63', '#f8bbd9')" style="background: linear-gradient(45deg, #e91e63, #f8bbd9);" title="ピンク"></button>
                            <button class="gradient-btn" onclick="setGradient('#424242', '#757575')" style="background: linear-gradient(45deg, #424242, #757575);" title="グレー"></button>
                            <button class="gradient-btn" onclick="setGradient('#673ab7', '#3f51b5')" style="background: linear-gradient(45deg, #673ab7, #3f51b5);" title="インディゴ"></button>
                            <button class="gradient-btn" onclick="setGradient('#009688', '#4db6ac')" style="background: linear-gradient(45deg, #009688, #4db6ac);" title="ティール"></button>
                            <button class="gradient-btn" onclick="setGradient('#ff9800', '#ffb74d')" style="background: linear-gradient(45deg, #ff9800, #ffb74d);" title="アンバー"></button>
                            <button class="gradient-btn" onclick="setGradient('#607d8b', '#90a4ae')" style="background: linear-gradient(45deg, #607d8b, #90a4ae);" title="ブルーグレー"></button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="control-group" id="imageSettings" style="display: none;">
                <label for="imageSize">画像表示モード:</label>
                <select id="imageSize">
                    <option value="contain">全体を表示（余白あり）</option>
                    <option value="cover">画像を拡大してフィット</option>
                    <option value="fill">画像を伸縮してフィット</option>
                </select>
            </div>
        </div>
        
        <div class="control-group">
            <label>生成するサイズ:</label>
            <div class="size-grid">
                <label class="size-checkbox">
                    <input type="checkbox" id="size16" checked>
                    <span>16×16px</span>
                </label>
                <label class="size-checkbox">
                    <input type="checkbox" id="size32" checked>
                    <span>32×32px</span>
                </label>
                <label class="size-checkbox">
                    <input type="checkbox" id="size48" checked>
                    <span>48×48px</span>
                </label>
                <label class="size-checkbox">
                    <input type="checkbox" id="size64" checked>
                    <span>64×64px</span>
                </label>
                <label class="size-checkbox">
                    <input type="checkbox" id="size128" checked>
                    <span>128×128px</span>
                </label>
                <label class="size-checkbox">
                    <input type="checkbox" id="size256" checked>
                    <span>256×256px</span>
                </label>
                <label class="size-checkbox">
                    <input type="checkbox" id="size512">
                    <span>512×512px</span>
                </label>
                <label class="size-checkbox">
                    <input type="checkbox" id="size1024">
                    <span>1024×1024px</span>
                </label>
            </div>
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <button class="generate-btn" onclick="generateIcons()">🎨 アイコンを生成</button>
            <button class="generate-btn" onclick="downloadAllIcons()" style="background: linear-gradient(45deg, #28a745, #20c997);">📁 個別ダウンロード</button>
            <button class="generate-btn" onclick="downloadAllAsZip()" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24);">📦 ZIPで一括ダウンロード</button>
        </div>
        
        <div class="preview" id="preview"></div>
        
        <!-- 実解像度プレビューモーダル -->
        <div id="fullSizeModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">実解像度プレビュー</h2>
                    <button class="close" onclick="closeModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="size-info" id="modalSizeInfo"></div>
                    <canvas id="modalCanvas" class="full-size-canvas"></canvas>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <div class="instructions-header" onclick="toggleInstructions()">
                <h3>📋 使用方法</h3>
                <span class="instructions-toggle">▼</span>
            </div>
            <div class="instructions-content" id="instructionsContent">
                <ol>
                    <li><strong>ソースを選択:</strong> 絵文字または画像ファイルを選択してください</li>
                    <li><strong>絵文字の場合:</strong> お好みの絵文字を選択または入力してください</li>
                    <li><strong>画像の場合:</strong> ファイル選択、ドラッグ&ドロップ、またはCtrl+Vで貼り付けしてください</li>
                    <li><strong>背景を設定:</strong> 単色、グラデーション、透明から選択してください</li>
                    <li><strong>サイズを選択:</strong> 必要なアイコンサイズにチェックを入れてください</li>
                    <li><strong>生成:</strong> 「アイコンを生成」ボタンをクリックしてください</li>
                    <li><strong>ダウンロード:</strong> 個別またはZIPで一括ダウンロードできます</li>
                </ol>
                
                <div class="feature-box">
                    <h4>💡 主な機能</h4>
                    <ul class="feature-list">
                        <li>🎨 豊富な絵文字サンプル</li>
                        <li>🖼️ 画像アップロード対応</li>
                        <li>📋 クリップボード貼り付け</li>
                        <li>🌈 グラデーション背景</li>
                        <li>📐 8つのサイズ対応</li>
                        <li>📦 ZIP一括ダウンロード</li>
                        <li>🔄 ドラッグ&ドロップ</li>
                        <li>📱 レスポンシブデザイン</li>
                        <li>⚡ リアルタイムプレビュー</li>
                    </ul>
                    <div style="background: rgba(255, 255, 255, 0.7); padding: 15px; border-radius: 10px; margin-top: 15px; font-size: 14px;">
                        <strong>📋 クリップボード貼り付けについて:</strong><br>
                        スクリーンショットをコピーした後、ページ上で<strong>Ctrl+V</strong>（Mac: Cmd+V）を押すと、自動的に画像タブに切り替わり画像が読み込まれます。
                    </div>
                </div>
                
                <div style="background: rgba(232, 245, 233, 0.9); padding: 25px; border-radius: 18px; margin-top: 25px; border: 2px solid rgba(46, 204, 113, 0.3); box-shadow: 0 6px 20px rgba(46, 204, 113, 0.15); backdrop-filter: blur(10px);">
                    <h4 style="margin-top: 0; color: #27ae60; font-weight: 700;">🎯 用途例</h4>
                    <ul style="margin: 10px 0;">
                        <li><strong>ウェブサイト:</strong> ファビコン、ロゴ、ナビゲーションアイコン</li>
                        <li><strong>アプリ:</strong> ホーム画面アイコン、機能アイコン</li>
                        <li><strong>ソーシャルメディア:</strong> プロフィール画像、ブランドアイコン</li>
                        <li><strong>デスクトップ:</strong> フォルダアイコン、ショートカットアイコン</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        let uploadedImage = null;
        let currentSource = 'emoji';
        
        const iconSizes = [
            { id: 'size16', size: 16 },
            { id: 'size32', size: 32 },
            { id: 'size48', size: 48 },
            { id: 'size64', size: 64 },
            { id: 'size128', size: 128 },
            { id: 'size256', size: 256 },
            { id: 'size512', size: 512 },
            { id: 'size1024', size: 1024 }
        ];
        
        function toggleSource(source) {
            currentSource = source;
            const emojiToggle = document.getElementById('emojiToggle');
            const imageToggle = document.getElementById('imageToggle');
            const emojiControls = document.getElementById('emojiControls');
            const imageControls = document.getElementById('imageControls');
            const imageSettings = document.getElementById('imageSettings');
            
            if (source === 'emoji') {
                emojiToggle.classList.add('active');
                imageToggle.classList.remove('active');
                emojiControls.style.display = 'flex';
                imageControls.style.display = 'none';
                imageSettings.style.display = 'none';
            } else {
                emojiToggle.classList.remove('active');
                imageToggle.classList.add('active');
                emojiControls.style.display = 'none';
                imageControls.style.display = 'flex';
                imageSettings.style.display = 'flex';
            }
        }
        
        function updateColorInputs() {
            const bgStyle = document.getElementById('bgStyle').value;
            const colorControls = document.getElementById('colorControls');
            const color2Group = document.getElementById('color2Group');
            const gradientSuggestions = document.getElementById('gradientSuggestions');
            
            if (bgStyle === 'transparent') {
                colorControls.style.display = 'none';
            } else {
                colorControls.style.display = 'block';
                
                if (bgStyle === 'gradient') {
                    color2Group.style.display = 'block';
                    gradientSuggestions.style.display = 'block';
                } else {
                    color2Group.style.display = 'none';
                    gradientSuggestions.style.display = 'none';
                }
            }
        }
        
        function setGradient(color1, color2) {
            document.getElementById('bgColor1').value = color1;
            document.getElementById('bgColor2').value = color2;
        }
        
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                processImageFile(file);
            }
        }
        
        function processImageFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    uploadedImage = img;
                    showImagePreview(e.target.result);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function handleClipboardPaste(event) {
            const items = event.clipboardData.items;
            
            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                
                if (item.type.indexOf('image') !== -1) {
                    event.preventDefault();
                    const file = item.getAsFile();
                    if (file) {
                        // 画像タブに自動切り替え
                        if (currentSource !== 'image') {
                            toggleSource('image');
                        }
                        processImageFile(file);
                    }
                    break;
                }
            }
        }
        
        function showImagePreview(src) {
            const uploadText = document.getElementById('uploadText');
            const preview = document.getElementById('imagePreview');
            
            // アップロードテキストを非表示にしてプレビューを表示
            uploadText.style.display = 'none';
            preview.style.display = 'block';
            preview.innerHTML = `
                <img src="${src}" alt="アップロードした画像">
                <br>
                <button class="remove-btn" onclick="removeImage()">🗑️ 画像を削除</button>
            `;
        }
        
        function removeImage() {
            uploadedImage = null;
            const uploadText = document.getElementById('uploadText');
            const preview = document.getElementById('imagePreview');
            
            // プレビューを非表示にしてアップロードテキストを表示
            preview.style.display = 'none';
            preview.innerHTML = '';
            uploadText.style.display = 'block';
            document.getElementById('imageUpload').value = '';
        }
        
        function setupDragDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('drag-over');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type.startsWith('image/')) {
                        const input = document.getElementById('imageUpload');
                        input.files = files;
                        handleImageUpload({ target: input });
                    }
                }
            });
        }
        
        function setEmoji(emoji) {
            document.getElementById('emoji').value = emoji;
        }
        
        function generateIcons() {
            const bgStyle = document.getElementById('bgStyle').value;
            const bgColor1 = document.getElementById('bgColor1').value;
            const bgColor2 = document.getElementById('bgColor2').value;
            
            if (currentSource === 'emoji') {
                const emoji = document.getElementById('emoji').value;
                if (!emoji.trim()) {
                    alert('絵文字を入力してください');
                    return;
                }
            } else {
                if (!uploadedImage) {
                    alert('画像をアップロードしてください');
                    return;
                }
            }
            
            // プレビューエリアをクリア
            const preview = document.getElementById('preview');
            preview.innerHTML = '';
            
            // 選択されたサイズのアイコンを生成
            iconSizes.forEach(({ id, size }) => {
                const checkbox = document.getElementById(id);
                if (checkbox.checked) {
                    createIconPreview(size, bgColor1, bgColor2, bgStyle);
                }
            });
        }
        
        function createIconPreview(size, bgColor1, bgColor2, bgStyle) {
            const preview = document.getElementById('preview');
            
            // プレビューアイテムを作成
            const previewItem = document.createElement('div');
            previewItem.className = 'preview-item';
            previewItem.innerHTML = `
                <h3>${size}×${size}px</h3>
                <div style="flex: 1; display: flex; align-items: center; justify-content: center; min-height: 150px;">
                    <canvas id="canvas${size}" width="${size}" height="${size}" style="display: block;" onclick="showFullSize(${size})" title="クリックして実解像度表示"></canvas>
                </div>
                <div>
                    <button class="download-btn" onclick="downloadIcon('canvas${size}', 'icon${size}.png')">📥 ダウンロード</button>
                </div>
            `;
            
            preview.appendChild(previewItem);
            
            // アイコンを生成
            const imageSize = document.getElementById('imageSize').value;
            
            if (currentSource === 'emoji') {
                const emoji = document.getElementById('emoji').value;
                generateIcon(`canvas${size}`, size, emoji, bgColor1, bgColor2, bgStyle, 'emoji');
            } else {
                generateIcon(`canvas${size}`, size, uploadedImage, bgColor1, bgColor2, bgStyle, 'image', imageSize);
            }
        }
        
        function generateIcon(canvasId, size, source, bgColor1, bgColor2, bgStyle, sourceType, imageSize = 'contain') {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // キャンバスをクリア
            ctx.clearRect(0, 0, size, size);
            
            // 背景を描画
            if (bgStyle === 'solid') {
                ctx.fillStyle = bgColor1;
                ctx.fillRect(0, 0, size, size);
            } else if (bgStyle === 'gradient') {
                const gradient = ctx.createLinearGradient(0, 0, size, size);
                gradient.addColorStop(0, bgColor1);
                gradient.addColorStop(1, bgColor2);
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, size, size);
            }
            
            // 内容を描画
            if (sourceType === 'emoji') {
                // 絵文字を描画
                const fontSize = size * 0.65;
                ctx.font = `${fontSize}px "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = '#000';
                ctx.fillText(source, size / 2, size / 2);
            } else {
                // 画像を描画
                drawImageWithFit(ctx, source, 0, 0, size, size, imageSize);
            }
        }
        
        function drawImageWithFit(ctx, img, x, y, width, height, fitMode) {
            const imgWidth = img.width;
            const imgHeight = img.height;
            const imgAspect = imgWidth / imgHeight;
            const canvasAspect = width / height;
            
            let drawWidth, drawHeight, drawX, drawY;
            
            if (fitMode === 'contain') {
                if (imgAspect > canvasAspect) {
                    drawWidth = width * 0.8;
                    drawHeight = (width * 0.8) / imgAspect;
                    drawX = x + (width - drawWidth) / 2;
                    drawY = y + (height - drawHeight) / 2;
                } else {
                    drawWidth = (height * 0.8) * imgAspect;
                    drawHeight = height * 0.8;
                    drawX = x + (width - drawWidth) / 2;
                    drawY = y + (height - drawHeight) / 2;
                }
            } else if (fitMode === 'cover') {
                if (imgAspect > canvasAspect) {
                    drawWidth = height * imgAspect;
                    drawHeight = height;
                    drawX = x + (width - drawWidth) / 2;
                    drawY = y;
                } else {
                    drawWidth = width;
                    drawHeight = width / imgAspect;
                    drawX = x;
                    drawY = y + (height - drawHeight) / 2;
                }
            } else {
                drawWidth = width;
                drawHeight = height;
                drawX = x;
                drawY = y;
            }
            
            ctx.drawImage(img, drawX, drawY, drawWidth, drawHeight);
        }
        
        function downloadAllIcons() {
            const canvases = document.querySelectorAll('.preview canvas');
            if (canvases.length === 0) {
                alert('まずアイコンを生成してください');
                return;
            }
            
            canvases.forEach((canvas, index) => {
                setTimeout(() => {
                    const size = canvas.width;
                    downloadIcon(canvas.id, `icon${size}.png`);
                }, index * 200);
            });
            
            setTimeout(() => {
                alert(`${canvases.length}個のアイコンファイルのダウンロードが完了しました！`);
            }, canvases.length * 200 + 500);
        }
        
        function downloadAllAsZip() {
            const canvases = document.querySelectorAll('.preview canvas');
            if (canvases.length === 0) {
                alert('まずアイコンを生成してください');
                return;
            }
            
            const zip = new JSZip();
            
            canvases.forEach(canvas => {
                const size = canvas.width;
                const dataUrl = canvas.toDataURL('image/png');
                const base64Data = dataUrl.split(',')[1];
                zip.file(`icon${size}.png`, base64Data, { base64: true });
            });
            
            // README.txtを追加
            const readmeContent = `アイコン生成ツールで作成されたアイコンファイルです

含まれるファイル:
${Array.from(canvases).map(canvas => `- icon${canvas.width}.png (${canvas.width}×${canvas.width}px)`).join('\n')}

使用用途:
- ウェブサイトのファビコン
- アプリケーションアイコン
- ソーシャルメディアのプロフィール画像
- その他のグラフィック素材

生成日時: ${new Date().toLocaleString('ja-JP')}
生成ツール: https://icon-generator.example.com`;
            
            zip.file('README.txt', readmeContent);
            
            zip.generateAsync({ type: 'blob' }).then(function(content) {
                saveAs(content, 'icons.zip');
            });
        }
        
        function downloadIcon(canvasId, filename) {
            const canvas = document.getElementById(canvasId);
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
        
        function showFullSize(size) {
            const originalCanvas = document.getElementById(`canvas${size}`);
            const modal = document.getElementById('fullSizeModal');
            const modalCanvas = document.getElementById('modalCanvas');
            const modalTitle = document.getElementById('modalTitle');
            const modalSizeInfo = document.getElementById('modalSizeInfo');
            
            // モーダルのタイトルと情報を設定
            modalTitle.textContent = `${size}×${size}px - 実解像度プレビュー`;
            modalSizeInfo.innerHTML = `
                <strong>実際のサイズ:</strong> ${size}×${size}ピクセル<br>
                <strong>ファイルサイズ目安:</strong> ${estimateFileSize(size)}<br>
                <strong>用途:</strong> ${getUsageInfo(size)}
            `;
            
            // モーダルのキャンバスを設定
            modalCanvas.width = size;
            modalCanvas.height = size;
            
            // 元のキャンバスの内容をコピー
            const modalCtx = modalCanvas.getContext('2d');
            modalCtx.clearRect(0, 0, size, size);
            modalCtx.drawImage(originalCanvas, 0, 0);
            
            // モーダルを表示
            modal.style.display = 'block';
        }
        
        function closeModal() {
            const modal = document.getElementById('fullSizeModal');
            modal.style.display = 'none';
        }
        
        function estimateFileSize(size) {
            // PNG ファイルサイズの大まかな推定
            const pixels = size * size;
            if (pixels <= 1024) return '1-2KB';
            if (pixels <= 4096) return '2-5KB';
            if (pixels <= 16384) return '5-15KB';
            if (pixels <= 65536) return '15-50KB';
            if (pixels <= 262144) return '50-150KB';
            return '150KB以上';
        }
        
        function getUsageInfo(size) {
            if (size <= 16) return 'ファビコン、タスクバー';
            if (size <= 32) return 'ファビコン、小さなボタン';
            if (size <= 48) return 'アプリアイコン、ツールバー';
            if (size <= 64) return 'デスクトップアイコン、リスト表示';
            if (size <= 128) return 'アプリストア、大きなアイコン';
            if (size <= 256) return 'Mac Dock、高解像度ディスプレイ';
            if (size <= 512) return 'アプリストア（高解像度）、印刷物';
            return 'Retina ディスプレイ、印刷物、拡大表示';
        }
        
        // モーダル外をクリックした時に閉じる
        window.onclick = function(event) {
            const modal = document.getElementById('fullSizeModal');
            if (event.target === modal) {
                closeModal();
            }
        }
        
        // ESCキーでモーダルを閉じる
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
        
        function toggleInstructions() {
            const content = document.getElementById('instructionsContent');
            const toggle = document.querySelector('.instructions-toggle');
            
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                toggle.classList.remove('open');
            } else {
                content.classList.add('open');
                toggle.classList.add('open');
            }
        }
        
        // 初期化
        window.onload = function() {
            setupDragDrop();
            updateColorInputs();
            generateIcons();
            
            // クリップボード貼り付け機能を追加
            document.addEventListener('paste', handleClipboardPaste);
            
            // フォーカス可能にするためにtabindexを設定
            document.body.tabIndex = -1;
            document.body.focus();
        };
    </script>
</body>
</html>